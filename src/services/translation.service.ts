import { Injectable, signal, effect, inject } from '@angular/core';
import { StorageService } from './storage.service';

export type Language = 'en' | 'lv';

const LANGUAGE_STORAGE_KEY = 'yume_tv_language';

const translations: { [lang in Language]: { [key: string]: string } } = {
  en: {
    // Header
    home: 'Home',
    browse: 'Browse',
    community: 'Community',
    signedInAs: 'Signed in as',
    adminPanel: 'Admin Panel',
    yourProfile: 'Your Profile',
    settings: 'Settings',
    logout: 'Logout',
    login: 'Login',
    // Home/Browse Page
    advancedSearch: 'Content Filters',
    allGenres: 'All Genres',
    allAudio: 'All Audio',
    allSubtitles: 'All Subtitles',
    allTypes: 'All Types',
    allYears: 'All Years',
    clearFilters: 'Clear Filters',
    recentlyWatched: 'Recently Watched',
    allContent: 'All Content',
    noResultsFound: 'No results found.',
    movies: 'Movies',
    tvShows: 'TV Shows',
    // Login Page
    loginTo: 'Login to',
    username: 'Username',
    password: 'Password',
    dontHaveAccount: "Don't have an account?",
    registerHere: 'Register here',
    errorInvalidCredentials: 'Invalid username or password.',
    // Register Page
    createAccount: 'Create an Account',
    email: 'Email',
    register: 'Register',
    alreadyHaveAccount: 'Already have an account?',
    loginHere: 'Login here',
    // Auth Service Messages
    errorUsernameExists: 'Username already exists.',
    errorEmailExists: 'Email is already in use.',
    registerSuccessAdmin: 'Registration successful! As the first user, you have been granted administrator privileges.',
    registerSuccessUser: 'Registration successful! You can now log in.',
    errorNoUserLoggedIn: 'No user is currently logged in.',
    errorUsernameTaken: 'That username is already taken.',
    profileUpdateSuccess: 'Profile updated successfully.',
    errorNoChanges: 'No changes were detected.',
    // Admin Panel
    dashboard: 'Dashboard',
    userManagement: 'User Management',
    contentManagement: 'Content Management',
    siteSettings: 'Site Settings',
    totalUsers: 'Total Users',
    totalMediaItems: 'Total Media Items',
    maintenanceMode: 'Maintenance Mode',
    on: 'On',
    off: 'Off',
    role: 'Role',
    roleUser: 'User',
    roleMod: 'Moderator',
    roleAdmin: 'Admin',
    editMedia: 'Edit Media',
    addNewMedia: 'Add New Media',
    title: 'Title',
    description: 'Description',
    posterImage: 'Poster Image',
    thumbnailImage: 'Thumbnail Image',
    releaseYear: 'Release Year',
    movie: 'Movie',
    tvShow: 'TV Show',
    genresPlaceholder: 'Genres (comma-separated, e.g., Action, Comedy)',
    tagsPlaceholder: 'Tags (comma-separated, e.g., New, HBO)',
    audioLanguages: 'Audio Languages',
    selectLanguages: 'Select languages',
    subtitleLanguages: 'Subtitle Languages',
    sourceUrl: 'Source URL (Movie or Episode)',
    licenseServerUrl: 'License Server URL',
    seasonsAndEpisodes: 'Seasons & Episodes',
    season: 'Season',
    removeSeason: 'Remove Season',
    episode: 'Episode',
    remove: 'Remove',
    epNumber: 'Ep. Number',
    epTitle: 'Ep. Title',
    thumbnailUrl: 'Thumbnail URL',
    addEpisode: 'Add Episode',
    addSeason: 'Add Season',
    enableWidevine: 'Enable Widevine Protection',
    updateMedia: 'Update Media',
    addMedia: 'Add Media',
    cancelEdit: 'Cancel Edit',
    existingMedia: 'Existing Media',
    poster: 'Poster',
    type: 'Type',
    year: 'Year',
    ageRating: 'Age Rating',
    actions: 'Actions',
    edit: 'Edit',
    delete: 'Delete',
    siteBranding: 'Site Branding',
    siteName: 'Site Name',
    enableMaintenanceMode: 'Enable Maintenance Mode',
    maintenanceMessage: 'Maintenance Message',
    saveSettings: 'Save Settings',
    alertMediaUpdated: 'Media updated successfully!',
    alertMediaAdded: 'Media added successfully!',
    alertConfirmDelete: 'Are you sure you want to delete this item?',
    alertSettingsSaved: 'Settings saved successfully!',
    // Movie Details / Media Info
    play: 'Play',
    comments: 'Comments',
    addCommentPlaceholder: 'Add a comment...',
    postComment: 'Post',
    mustBeLoggedInToComment: 'You must be logged in to comment.',
    noCommentsYet: 'No comments yet.',
    save: 'Save',
    cancel: 'Cancel',
    confirmDeleteComment: 'Are you sure you want to delete this comment?',
    // Player
    upNext: 'Up Next',
    playNext: 'Play Next',
    playingIn: 'Playing in',
    seconds: 'seconds...',
    episodes: 'Episodes',
    audio: 'Audio',
    subtitles: 'Subtitles',
    // Forum
    forumAll: 'All',
    forumGeneral: 'General',
    forumUpdates: 'Updates',
    forumRecommendations: 'Recommendations',
    forumDiscussion: 'Discussion',
    forumPostsSuffix: 'posts',
    forumCreate: 'Create',
    forumMyPosts: 'My Posts',
    forumSortBy: 'Sort by',
    forumSortNewest: 'Newest',
    forumSortOldest: 'Oldest',
    forumSortTop: 'Top Voted',
    forumPinned: 'Pinned',
    forumUnpin: 'Unpin',
    forumPin: 'Pin',
    forumNoPostsFound: 'No posts found.',
    alertConfirmDeletePost: 'Are you sure you want to delete this post?',
    alertMustBeLoggedInToVote: 'You must be logged in to vote.',
    forumBackToCommunity: 'Back to Community',
    forumPostedBy: 'Posted by',
    forumLeaveAComment: 'Leave a comment',
    forumCommentPlaceholder: 'What are your thoughts?',
    forumComment: 'Comment',
    loggedIn: 'logged in',
    forumBeFirstToComment: 'Be the first to comment!',
    forumPostNotFound: 'Post Not Found',
    forumPostNotFoundMessage: "We couldn't find the post you're looking for.",
    forumEditPost: 'Edit Post',
    forumCreateNewPost: 'Create New Post',
    forumCategory: 'Category',
    forumContent: 'Content',
    forumTitlePlaceholder: 'Enter a compelling title',
    forumContentPlaceholder: "What's on your mind?",
    forumSaveChanges: 'Save Changes',
    forumPublishPost: 'Publish Post',
    forumReply: 'Reply',
    forumReplyPlaceholder: 'Write a reply...',
    forumSubmit: 'Submit',
    // Time since
    timeJustNow: 'just now',
    timeYearAgo: 'year ago',
    timeYearsAgo: 'years ago',
    timeMonthAgo: 'month ago',
    timeMonthsAgo: 'months ago',
    timeDayAgo: 'day ago',
    timeDaysAgo: 'days ago',
    timeHourAgo: 'hour ago',
    timeHoursAgo: 'hours ago',
    timeMinuteAgo: 'minute ago',
    timeMinutesAgo: 'minutes ago',
    // Profile Page Activity
    profileActivityCommentedOn: 'Commented on',
    profileActivityCreatedPost: 'Created a post:',
    profileActivityRepliedIn: 'Replied in',
    profileActivityNoActivity: 'No activity to show.',
    profileUserNotFound: 'User Not Found',
    profileUserNotFoundMessage: "We couldn't find a profile with this ID.",
    profileRecentlyWatched: 'Recently Watched',
    profileNoRecentWatches: "hasn't watched anything recently.",
    profileActivity: 'Activity',
    // Ratings
    ratingFrom: 'from',
    ratingSingular: 'rating',
    ratingPlural: 'ratings',
    yourRating: 'Your Rating:',
    loginToRate: 'to rate this title.',
  },
  lv: {
    // Header
    home: 'Sākums',
    browse: 'Pārlūkot',
    community: 'Kopiena',
    signedInAs: 'Pieslēdzies kā',
    adminPanel: 'Admin Panelis',
    yourProfile: 'Tavs Profils',
    settings: 'Iestatījumi',
    logout: 'Iziet',
    login: 'Pieslēgties',
    // Home/Browse Page
    advancedSearch: 'Satura Filtri',
    allGenres: 'Visi Žanri',
    allAudio: 'Visa Audio',
    allSubtitles: 'Visi Subtitri',
    allTypes: 'Visi Tipi',
    allYears: 'Visi Gadi',
    clearFilters: 'Notīrīt Filtrus',
    recentlyWatched: 'Nesen Skatītie',
    allContent: 'Viss Saturs',
    noResultsFound: 'Nekas netika atrasts.',
    movies: 'Filmas',
    tvShows: 'Seriāli',
    // Login Page
    loginTo: 'Pieslēgties',
    username: 'Lietotājvārds',
    password: 'Parole',
    dontHaveAccount: 'Nav konta?',
    registerHere: 'Reģistrēties šeit',
    errorInvalidCredentials: 'Nepareizs lietotājvārds vai parole.',
    // Register Page
    createAccount: 'Izveidot Kontu',
    email: 'E-pasts',
    register: 'Reģistrēties',
    alreadyHaveAccount: 'Jau ir konts?',
    loginHere: 'Pieslēgties šeit',
    // Auth Service Messages
    errorUsernameExists: 'Lietotājvārds jau pastāv.',
    errorEmailExists: 'E-pasts jau tiek izmantots.',
    registerSuccessAdmin: 'Reģistrācija veiksmīga! Kā pirmajam lietotājam, jums ir piešķirtas administratora tiesības.',
    registerSuccessUser: 'Reģistrācija veiksmīga! Tagad varat pieslēgties.',
    errorNoUserLoggedIn: 'Neviens lietotājs nav pieslēdzies.',
    errorUsernameTaken: 'Šis lietotājvārds jau ir aizņemts.',
    profileUpdateSuccess: 'Profils veiksmīgi atjaunināts.',
    errorNoChanges: 'Nekādas izmaiņas netika konstatētas.',
    // Admin Panel
    dashboard: 'Mērinstrumentu Panelis',
    userManagement: 'Lietotāju Pārvaldība',
    contentManagement: 'Satura Pārvaldība',
    siteSettings: 'Lapas Iestatījumi',
    totalUsers: 'Kopā Lietotāju',
    totalMediaItems: 'Kopā Satura Vienību',
    maintenanceMode: 'Apkopes Režīms',
    on: 'Ieslēgts',
    off: 'Izslēgts',
    role: 'Loma',
    roleUser: 'Lietotājs',
    roleMod: 'Moderators',
    roleAdmin: 'Administrators',
    editMedia: 'Rediģēt Saturu',
    addNewMedia: 'Pievienot Jaunu Saturu',
    title: 'Nosaukums',
    description: 'Apraksts',
    posterImage: 'Plakāta Attēls',
    thumbnailImage: 'Sīktēla Attēls',
    releaseYear: 'Izlaišanas Gads',
    movie: 'Filma',
    tvShow: 'Seriāls',
    genresPlaceholder: 'Žanri (atdalīti ar komatu, piem., Asa sižeta, Komēdija)',
    tagsPlaceholder: 'Birkas (atdalītas ar komatu, piem., Jauna, HBO)',
    audioLanguages: 'Audio Valodas',
    selectLanguages: 'Izvēlieties valodas',
    subtitleLanguages: 'Subtitru Valodas',
    sourceUrl: 'Avota URL (Filmai vai Epizodei)',
    licenseServerUrl: 'Licenču Servera URL',
    seasonsAndEpisodes: 'Sezonas un Epizodes',
    season: 'Sezona',
    removeSeason: 'Noņemt Sezonu',
    episode: 'Epizode',
    remove: 'Noņemt',
    epNumber: 'Ep. numurs',
    epTitle: 'Ep. nosaukums',
    thumbnailUrl: 'Sīktēla URL',
    addEpisode: 'Pievienot Epizodi',
    addSeason: 'Pievienot Sezonu',
    enableWidevine: 'Iespējot Widevine Aizsardzību',
    updateMedia: 'Atjaunināt Saturu',
    addMedia: 'Pievienot Saturu',
    cancelEdit: 'Atcelt Rediģēšanu',
    existingMedia: 'Esošais Saturs',
    poster: 'Plakāts',
    type: 'Tips',
    year: 'Gads',
    ageRating: 'Vecuma Cenzs',
    actions: 'Darbības',
    edit: 'Rediģēt',
    delete: 'Dzēst',
    siteBranding: 'Lapas Brendings',
    siteName: 'Lapas Nosaukums',
    enableMaintenanceMode: 'Iespējot Apkopes Režīmu',
    maintenanceMessage: 'Apkopes Ziņojums',
    saveSettings: 'Saglabāt Iestatījumus',
    alertMediaUpdated: 'Saturs veiksmīgi atjaunināts!',
    alertMediaAdded: 'Saturs veiksmīgi pievienots!',
    alertConfirmDelete: 'Vai esat pārliecināts, ka vēlaties dzēst šo vienumu?',
    alertSettingsSaved: 'Iestatījumi veiksmīgi saglabāti!',
    // Movie Details / Media Info
    play: 'Skatīties',
    comments: 'Komentāri',
    addCommentPlaceholder: 'Pievienot komentāru...',
    postComment: 'Publicēt',
    mustBeLoggedInToComment: 'Lai komentētu, ir jābūt pieslēgušamies.',
    noCommentsYet: 'Vēl nav komentāru.',
    save: 'Saglabāt',
    cancel: 'Atcelt',
    confirmDeleteComment: 'Vai tiešām vēlaties dzēst šo komentāru?',
    // Player
    upNext: 'Nākamais',
    playNext: 'Skatīties Nākamo',
    playingIn: 'Sāksies pēc',
    seconds: 'sekundēm...',
    episodes: 'Epizodes',
    audio: 'Audio',
    subtitles: 'Subtitri',
    // Forum
    forumAll: 'Visi',
    forumGeneral: 'Vispārīgi',
    forumUpdates: 'Atjauninājumi',
    forumRecommendations: 'Ieteikumi',
    forumDiscussion: 'Diskusijas',
    forumPostsSuffix: 'ieraksti',
    forumCreate: 'Izveidot',
    forumMyPosts: 'Mani Ieraksti',
    forumSortBy: 'Kārtot pēc',
    forumSortNewest: 'Jaunākie',
    forumSortOldest: 'Vecākie',
    forumSortTop: 'Visvairāk Balsotie',
    forumPinned: 'Piesprausts',
    forumUnpin: 'Atspraust',
    forumPin: 'Piespraust',
    forumNoPostsFound: 'Nav atrasts neviens ieraksts.',
    alertConfirmDeletePost: 'Vai esat pārliecināts, ka vēlaties dzēst šo ierakstu?',
    alertMustBeLoggedInToVote: 'Lai balsotu, jums jābūt pieslēgušamies.',
    forumBackToCommunity: 'Atpakaļ uz Kopienu',
    forumPostedBy: 'Publicēja',
    forumLeaveAComment: 'Atstājiet komentāru',
    forumCommentPlaceholder: 'Kādas ir jūsu domas?',
    forumComment: 'Komentēt',
    loggedIn: 'pieslēdzies',
    forumBeFirstToComment: 'Esi pirmais, kas komentē!',
    forumPostNotFound: 'Ieraksts Nav Atrasts',
    forumPostNotFoundMessage: 'Mēs nevarējām atrast meklēto ierakstu.',
    forumEditPost: 'Rediģēt Ierakstu',
    forumCreateNewPost: 'Izveidot Jaunu Ierakstu',
    forumCategory: 'Kategorija',
    forumContent: 'Saturs',
    forumTitlePlaceholder: 'Ievadiet saistošu virsrakstu',
    forumContentPlaceholder: 'Kas jums prātā?',
    forumSaveChanges: 'Saglabāt Izmaiņas',
    forumPublishPost: 'Publicēt Ierakstu',
    forumReply: 'Atbildēt',
    forumReplyPlaceholder: 'Rakstiet atbildi...',
    forumSubmit: 'Iesniegt',
    // Time since
    timeJustNow: 'tikko',
    timeYearAgo: 'gadu atpakaļ',
    timeYearsAgo: 'gadiem atpakaļ',
    timeMonthAgo: 'mēnesi atpakaļ',
    timeMonthsAgo: 'mēnešiem atpakaļ',
    timeDayAgo: 'dienu atpakaļ',
    timeDaysAgo: 'dienām atpakaļ',
    timeHourAgo: 'stundu atpakaļ',
    timeHoursAgo: 'stundām atpakaļ',
    timeMinuteAgo: 'minūti atpakaļ',
    timeMinutesAgo: 'minūtēm atpakaļ',
    // Profile Page Activity
    profileActivityCommentedOn: 'Komentēja',
    profileActivityCreatedPost: 'Izveidoja ierakstu:',
    profileActivityRepliedIn: 'Atbildēja',
    profileActivityNoActivity: 'Nav darbību, ko rādīt.',
    profileUserNotFound: 'Lietotājs Nav Atrasts',
    profileUserNotFoundMessage: 'Mēs nevarējām atrast profilu ar šo ID.',
    profileRecentlyWatched: 'Nesen Skatītie',
    profileNoRecentWatches: 'nesen neko nav skatījies.',
    profileActivity: 'Aktivitāte',
    // Ratings
    ratingFrom: 'no',
    ratingSingular: 'vērtējuma',
    ratingPlural: 'vērtējumiem',
    yourRating: 'Tavs Vērtējums:',
    loginToRate: 'lai novērtētu šo saturu.',
  },
};

@Injectable({ providedIn: 'root' })
export class TranslationService {
  language = signal<Language>('en');
  private storageService = inject(StorageService);

  constructor() {
    const storedLang = this.storageService.getItem(LANGUAGE_STORAGE_KEY);
    if (storedLang && (storedLang === 'en' || storedLang === 'lv')) {
      this.language.set(storedLang);
    }

    effect(() => {
      this.storageService.setItem(LANGUAGE_STORAGE_KEY, this.language());
    });
  }

  setLanguage(lang: Language): void {
    this.language.set(lang);
  }

  translate(key: string): string {
    return translations[this.language()][key] || key;
  }
}
