
<div class="container mx-auto px-4 py-8">
  <h1 class="text-4xl font-bold mb-8 text-text-primary">Account Settings</h1>

  @if (currentUser(); as user) {
    <div class="md:grid md:grid-cols-12 md:gap-8">
      
      <!-- Sidebar Navigation (Desktop) -->
      <aside class="hidden md:block md:col-span-3">
        <nav class="space-y-2">
          <button (click)="activeTab.set('profile')" 
                  class="w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors text-left"
                  [class]="activeTab() === 'profile' ? 'bg-surface-light text-text-primary' : 'text-text-secondary hover:bg-surface'">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 flex-shrink-0"><path d="M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.465 14.493a1.23 1.23 0 0 0 .41 1.412A9.957 9.957 0 0 0 10 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 0 0-13.074 0Z" /></svg>
            <span class="font-semibold">Public Profile</span>
          </button>
          <button (click)="activeTab.set('account')" 
                  class="w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors text-left"
                  [class]="activeTab() === 'account' ? 'bg-surface-light text-text-primary' : 'text-text-secondary hover:bg-surface'">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 flex-shrink-0"><path fill-rule="evenodd" d="M10 1a4.5 4.5 0 0 0-4.5 4.5V9H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2h-.5V5.5A4.5 4.5 0 0 0 10 1Zm3 8V5.5a3 3 0 1 0-6 0V9h6Z" clip-rule="evenodd" /></svg>
            <span class="font-semibold">Account & Security</span>
          </button>
          <button (click)="activeTab.set('player')" 
                  class="w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors text-left"
                  [class]="activeTab() === 'player' ? 'bg-surface-light text-text-primary' : 'text-text-secondary hover:bg-surface'">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 flex-shrink-0"><path d="M6.3 2.841A1.5 1.5 0 0 0 4 4.11V15.89a1.5 1.5 0 0 0 2.3 1.269l9.344-5.89a1.5 1.5 0 0 0 0-2.538L6.3 2.841Z" /></svg>
            <span class="font-semibold">Player Settings</span>
          </button>
        </nav>
      </aside>

      <!-- Tab Navigation (Mobile) -->
      <div class="block md:hidden mb-6 border-b border-border">
        <nav class="flex -mb-px space-x-6">
          <button (click)="activeTab.set('profile')"
                  class="py-3 px-1 font-semibold transition-colors"
                  [class]="activeTab() === 'profile' ? 'text-primary border-b-2 border-primary' : 'text-text-secondary hover:text-text-primary'">
            Profile
          </button>
          <button (click)="activeTab.set('account')"
                  class="py-3 px-1 font-semibold transition-colors"
                  [class]="activeTab() === 'account' ? 'text-primary border-b-2 border-primary' : 'text-text-secondary hover:text-text-primary'">
            Account
          </button>
          <button (click)="activeTab.set('player')"
                  class="py-3 px-1 font-semibold transition-colors"
                  [class]="activeTab() === 'player' ? 'text-primary border-b-2 border-primary' : 'text-text-secondary hover:text-text-primary'">
            Player
          </button>
        </nav>
      </div>

      <!-- Main Content -->
      <main class="md:col-span-9 space-y-8">
        @switch (activeTab()) {
          @case ('profile') {
            <!-- Profile Picture Card -->
            <div class="bg-surface rounded-lg shadow-lg overflow-hidden">
              <div class="p-6">
                <h2 class="text-xl font-semibold text-text-primary">Profile Picture</h2>
                <p class="text-sm text-text-secondary mt-1">Upload a new profile picture. Recommended size: 200x200px.</p>
              </div>
              <div class="px-6 py-4 space-y-4">
                <div class="flex items-center gap-6">
                  @if (newProfilePicture()) {
                    <img [src]="newProfilePicture()" alt="New Profile Picture" class="w-24 h-24 rounded-full object-cover border-2 border-primary">
                  } @else {
                    @if (user.profilePictureUrl) {
                      <img [src]="user.profilePictureUrl.replace('/40/40', '/96/96')" [alt]="user.username" class="w-24 h-24 rounded-full object-cover">
                    } @else {
                      <div class="w-24 h-24 rounded-full bg-surface-light flex items-center justify-center">
                        <svg class="h-16 w-16 text-slate-400" fill="currentColor" viewBox="0 0 24 24"><path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                      </div>
                    }
                  }
                  <div class="flex-grow">
                    <input type="file" (change)="onFileSelected($event)" accept="image/*" class="block w-full text-sm text-text-secondary file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-surface-light file:text-text-primary hover:file:bg-border">
                  </div>
                </div>
              </div>
              <div class="bg-background/50 px-6 py-4 flex justify-end items-center gap-4">
                @if(pfpMessage(); as msg) {
                  <p class="text-sm" [class.text-green-400]="msg.type === 'success'" [class.text-red-400]="msg.type === 'error'">{{ msg.text | translate }}</p>
                }
                <button (click)="saveProfilePicture()" [disabled]="!newProfilePicture()" class="bg-primary text-white px-6 py-2 rounded-md font-bold hover:bg-blue-600 transition disabled:bg-surface-light disabled:cursor-not-allowed">Save</button>
              </div>
            </div>

            <!-- Username Card -->
            <div class="bg-surface rounded-lg shadow-lg overflow-hidden">
              <div class="p-6">
                <h2 class="text-xl font-semibold text-text-primary">Username</h2>
                <p class="text-sm text-text-secondary mt-1">Change your username. This will be displayed publicly.</p>
              </div>
              <div class="px-6 py-4">
                <label for="username" class="sr-only">New Username</label>
                <input type="text" id="username" name="username" [(ngModel)]="newUsername" class="w-full p-3 bg-surface-light border border-border rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-primary">
              </div>
              <div class="bg-background/50 px-6 py-4 flex justify-end items-center gap-4">
                @if(usernameMessage(); as msg) {
                  <p class="text-sm" [class.text-green-400]="msg.type === 'success'" [class.text-red-400]="msg.type === 'error'">{{ msg.text | translate }}</p>
                }
                <button (click)="saveUsername()" class="bg-primary text-white px-6 py-2 rounded-md font-bold hover:bg-blue-600 transition">Save</button>
              </div>
            </div>
          }
          @case ('account') {
            <!-- Password Card -->
            <div class="bg-surface rounded-lg shadow-lg overflow-hidden">
              <div class="p-6">
                <h2 class="text-xl font-semibold text-text-primary">Change Password</h2>
                <p class="text-sm text-text-secondary mt-1">Update your password. Make sure it's at least 6 characters long.</p>
              </div>
              <form (ngSubmit)="savePassword()" class="divide-y divide-border">
                <div class="px-6 py-4 space-y-4">
                  <div>
                    <label for="currentPassword" class="block text-text-secondary mb-2 text-sm font-semibold">Current Password</label>
                    <input type="password" id="currentPassword" name="currentPassword" [(ngModel)]="currentPassword" required class="w-full p-3 bg-surface-light border border-border rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-primary">
                  </div>
                  <div>
                    <label for="newPassword" class="block text-text-secondary mb-2 text-sm font-semibold">New Password</label>
                    <input type="password" id="newPassword" name="newPassword" [(ngModel)]="newPassword" required minlength="6" class="w-full p-3 bg-surface-light border border-border rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-primary">
                  </div>
                  <div>
                    <label for="confirmPassword" class="block text-text-secondary mb-2 text-sm font-semibold">Confirm New Password</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" [(ngModel)]="confirmPassword" required class="w-full p-3 bg-surface-light border border-border rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-primary">
                  </div>
                </div>
                <div class="bg-background/50 px-6 py-4 flex justify-end items-center gap-4">
                  @if(passwordMessage(); as msg) {
                    <p class="text-sm" [class.text-green-400]="msg.type === 'success'" [class.text-red-400]="msg.type === 'error'">{{ msg.text | translate }}</p>
                  }
                  <button type="submit" class="bg-primary text-white px-6 py-2 rounded-md font-bold hover:bg-blue-600 transition">Update Password</button>
                </div>
              </form>
            </div>
          }
          @case ('player') {
            <!-- Player Settings Card -->
            <div class="bg-surface rounded-lg shadow-lg overflow-hidden">
              <div class="p-6">
                <h2 class="text-xl font-semibold text-text-primary">Player Settings</h2>
                <p class="text-sm text-text-secondary mt-1">Customize your video playback experience.</p>
              </div>
              <form (ngSubmit)="savePlayerSettings()" class="divide-y divide-border">
                <div class="px-6 py-4 space-y-4">
                  <div class="flex items-center justify-between">
                    <div>
                      <label for="autoPlayToggle" class="font-semibold text-text-primary">Auto-play</label>
                      <p class="text-sm text-text-secondary">Automatically start playing when you open a movie or episode.</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" [(ngModel)]="autoPlay" name="autoPlay" id="autoPlayToggle" class="sr-only peer">
                      <div class="w-11 h-6 bg-border rounded-full peer peer-focus:ring-2 peer-focus:ring-primary peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                  </div>
                  <div class="flex items-center justify-between pt-4">
                    <div>
                      <label for="autoNextToggle" class="font-semibold text-text-primary">Auto-play next episode</label>
                      <p class="text-sm text-text-secondary">Automatically play the next episode when the current one ends.</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" [(ngModel)]="autoNext" name="autoNext" id="autoNextToggle" class="sr-only peer">
                      <div class="w-11 h-6 bg-border rounded-full peer peer-focus:ring-2 peer-focus:ring-primary peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                  </div>
                </div>
                <div class="bg-background/50 px-6 py-4 flex justify-end items-center gap-4">
                  @if (playerSettingsMessage()) {
                    <p class="text-sm text-green-400">{{ playerSettingsMessage() | translate }}</p>
                  }
                  <button type="submit" class="bg-primary text-white px-6 py-2 rounded-md font-bold hover:bg-blue-600 transition">Save Changes</button>
                </div>
              </form>
            </div>
          }
        }
      </main>

    </div>
  }
</div>