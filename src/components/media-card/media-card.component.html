<a [routerLink]="['/media', media().id]" class="bg-slate-800 rounded-lg overflow-hidden shadow-lg cursor-pointer transition-all duration-300 group flex flex-col h-full hover:scale-105 hover:shadow-primary/40 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary">
  <div class="relative">
    <img [src]="media().posterUrl" [alt]="media().title" class="w-full object-cover aspect-[4/5] bg-slate-700">
    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 flex items-center justify-center transition-all duration-300">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-12 h-12 text-white opacity-0 group-hover:opacity-100 transform group-hover:scale-110 transition-all duration-300">
        <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm14.024-.983a1.125 1.125 0 010 1.966l-5.603 3.113A1.125 1.125 0 019 15.113V8.887c0-.857.921-1.4 1.671-.983l5.603 3.113z" clip-rule="evenodd" />
      </svg>
    </div>
    @if (watchedItem(); as item) {
       @if (watchedEpisodeInfo(); as epInfo) {
        <div class="absolute top-2 right-2 bg-black/70 text-white text-xs font-bold px-2 py-1 rounded">
          {{ epInfo }}
        </div>
      }
      <div class="absolute bottom-0 left-0 w-full h-1.5 bg-slate-600/50">
        <div class="h-full bg-primary" [style.width.%]="progressPercent()"></div>
      </div>
    }
  </div>
  <div class="p-3 flex-grow flex flex-col justify-between">
    <div>
      <h3 class="text-white font-bold text-base truncate" [title]="media().title">{{ media().title }}</h3>
      <p class="text-gray-400 text-sm mt-1">{{ media().releaseYear }} &middot; {{ media().type }}</p>
    </div>
    <div class="flex items-center gap-3 text-xs text-gray-400 mt-2 truncate" [title]="'Audio: ' + media().audioLanguages.join(', ') + '\nSubtitles: ' + media().subtitleLanguages.join(', ')">
      <!-- Audio -->
      <div class="flex items-center gap-1.5 min-w-0">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4 flex-shrink-0"><path d="M7 1a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2 .5.5 0 0 1 .5.5v1.5a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1 0-1h.5V9a2 2 0 0 0-2-2V3a2 2 0 0 0-2 2 .5.5 0 0 1-1 0a3 3 0 0 1 3-3V1.5A.5.5 0 0 1 5 1h2Zm.5 9.5a.5.5 0 0 0-.5-.5H3.5a.5.5 0 0 1 0-1H7a2 2 0 0 0 2-2V3a3 3 0 0 1 3 3v4a2 2 0 0 1-2 2v.5a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5V10Z" /></svg>
        <div class="flex items-center gap-1">
          @for(lang of media().audioLanguages.slice(0, 2); track lang) {
            @if (getCountryCode(lang); as code) {
              <img [src]="'https://flagcdn.com/w20/' + code + '.png'" [alt]="lang + ' flag'" class="w-5 h-auto rounded-sm flex-shrink-0">
            }
          }
          @if (media().audioLanguages.length > 2) {
            <span class="text-xs font-bold bg-gray-700 px-1.5 py-0.5 rounded-sm">+{{ media().audioLanguages.length - 2 }}</span>
          }
          @if(media().audioLanguages.length === 0) {
            <span>-</span>
          }
        </div>
      </div>
      <!-- Separator -->
      <span class="border-l border-gray-600 h-3"></span>
      <!-- Subtitles -->
      <div class="flex items-center gap-1.5 min-w-0">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4 flex-shrink-0"><path fill-rule="evenodd" d="M2 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v5.5a1 1 0 0 1-1 1H6.707l-2.853 2.854a.5.5 0 0 1-.854-.354V9.5A1 1 0 0 1 2 8.5V3Zm1 .5v5a.5.5 0 0 0 .5.5H4v1.293L5.293 9H13V3.5H3Z" clip-rule="evenodd" /><path d="M5 5.25a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5H5.75a.75.75 0 0 1-.75-.75Zm0 2.5a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5H5.75a.75.75 0 0 1-.75-.75Z" /></svg>
        <div class="flex items-center gap-1">
          @for(lang of media().subtitleLanguages.slice(0, 2); track lang) {
            @if (getCountryCode(lang); as code) {
              <img [src]="'https://flagcdn.com/w20/' + code + '.png'" [alt]="lang + ' flag'" class="w-5 h-auto rounded-sm flex-shrink-0">
            }
          }
          @if (media().subtitleLanguages.length > 2) {
            <span class="text-xs font-bold bg-gray-700 px-1.5 py-0.5 rounded-sm">+{{ media().subtitleLanguages.length - 2 }}</span>
          }
          @if(media().subtitleLanguages.length === 0) {
            <span>-</span>
          }
        </div>
      </div>
    </div>
  </div>
</a>
